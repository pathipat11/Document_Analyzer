{% extends "documents/base.html" %}
{% block title %}Edit Profile Â· Document Analyzer{% endblock %}

{% block content %}
<div class="mx-auto card p-6">
    <div class="flex items-center justify-between gap-4">
        <div>
            <h1 class="text-xl font-semibold">Edit Profile</h1>
            <p class="mt-1 text-sm text-slate-500 dark:text-slate-400">Update your account information.</p>
        </div>
        <a class="btn-outline" href="{% url 'accounts:profile' %}">Back</a>
    </div>

    <form method="post" enctype="multipart/form-data" class="mt-6 space-y-6">
        {% csrf_token %}

        <div class="rounded-xl border border-slate-200 p-4 dark:border-slate-800">
            <div class="text-sm font-semibold">Account</div>
            <div class="mt-3 grid grid-cols-1 gap-4 sm:grid-cols-2">
                <div>
                    <label class="block text-sm font-medium mb-1">Email</label>
                    {{ uform.email }}
                    {% if uform.email.errors %}<div class="mt-1 text-xs text-red-600">{{ uform.email.errors }}</div>
                    {% endif %}
                </div>
                <div></div>

                <div>
                    <label class="block text-sm font-medium mb-1">First name</label>
                    {{ uform.first_name }}
                    {% if uform.first_name.errors %}<div class="mt-1 text-xs text-red-600">{{ uform.first_name.errors }}
                    </div>{% endif %}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Last name</label>
                    {{ uform.last_name }}
                    {% if uform.last_name.errors %}<div class="mt-1 text-xs text-red-600">{{ uform.last_name.errors }}
                    </div>{% endif %}
                </div>
            </div>
        </div>

        <div class="rounded-xl border border-slate-200 p-4 dark:border-slate-800">
            <div class="text-sm font-semibold">Profile</div>
            <div class="mt-4 flex flex-col sm:flex-row sm:items-center gap-4">
                {% with p=request.user.profile %}
                {% if p.avatar %}
                <img id="avatarCurrent" src="{{ p.avatar.url }}" alt="Current avatar"
                    class="h-20 w-20 rounded-full object-cover ring-2 ring-slate-200 dark:ring-slate-800" />
                {% else %}
                <div id="avatarFallback"
                    class="h-20 w-20 rounded-full bg-slate-200 dark:bg-slate-700 grid place-items-center
                        text-xl font-semibold text-slate-700 dark:text-slate-100 ring-2 ring-slate-200 dark:ring-slate-800">
                    {{ request.user.username|slice:":1"|upper }}
                </div>
                {% endif %}
                {% endwith %}

                <div class="flex-1">
                    <div class="text-sm font-medium">Profile photo</div>
                    <div class="mt-1 text-xs text-slate-500 dark:text-slate-400">
                        PNG/JPG recommended. Square image looks best.
                    </div>

                    <div class="mt-3 flex items-center gap-3">
                        <img id="avatarPreview"
                            class="hidden h-14 w-14 rounded-full object-cover ring-2 ring-slate-200 dark:ring-slate-800"
                            alt="New avatar preview" />
                        <div id="avatarPreviewText" class="hidden text-xs text-slate-500 dark:text-slate-400">
                            New photo selected (not saved yet)
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-3 grid grid-cols-1 gap-4 sm:grid-cols-2">
                <div>
                    <label class="block text-sm font-medium mb-1">Phone</label>
                    {{ pform.phone }}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Organization</label>
                    {{ pform.organization }}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Job title</label>
                    {{ pform.job_title }}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Avatar</label>
                    {{ pform.avatar }}
                </div>
                <div class="sm:col-span-2">
                    <label class="block text-sm font-medium mb-1">Bio</label>
                    {{ pform.bio }}
                </div>
            </div>
        </div>

        <div class="rounded-xl border border-slate-200 p-4 dark:border-slate-800">
            <div class="text-sm font-semibold">Address</div>
            <div class="mt-3 grid grid-cols-1 gap-4 sm:grid-cols-2">
                <div>
                    <label class="block text-sm font-medium mb-1">Address line 1</label>
                    {{ pform.address_line1 }}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Address line 2</label>
                    {{ pform.address_line2 }}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">City</label>
                    {{ pform.city }}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">State</label>
                    {{ pform.state }}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Postal code</label>
                    {{ pform.postal_code }}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Country</label>
                    {{ pform.country }}
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Date of birth</label>
                    {{ pform.date_of_birth }}
                </div>
            </div>
        </div>

        <div class="rounded-xl border border-slate-200 p-4 dark:border-slate-800">
            <div class="text-sm font-semibold">Notifications</div>
            <div class="mt-3 space-y-3 text-sm">
                <label class="flex items-center gap-2">
                    {{ pform.notify_email }} <span>Email notifications</span>
                </label>
                <label class="flex items-center gap-2">
                    {{ pform.notify_product }} <span>Product updates</span>
                </label>
                <label class="flex items-center gap-2">
                    {{ pform.notify_security }} <span>Security alerts</span>
                </label>
            </div>
        </div>

        <div class="flex items-center gap-2">
            <button class="btn" type="submit">Save changes</button>
            <a class="btn-outline" href="{% url 'accounts:profile' %}">Cancel</a>
        </div>
        <div
            class="rounded-xl border border-red-200 bg-red-50 p-4 text-red-800 dark:border-red-800 dark:bg-red-950/40 dark:text-red-200">
            <div class="font-semibold">Danger Zone</div>
            <p class="mt-1 text-sm opacity-90">Deactivating disables login. Deleting will remove your documents
                permanently.</p>

            <div class="mt-3 flex flex-wrap gap-2">
                <form method="post" action="{% url 'accounts:deactivate' %}">
                    {% csrf_token %}
                    <button class="btn-outline" type="submit">Deactivate account</button>
                </form>

                <form method="post" action="{% url 'accounts:delete' %}"
                    onsubmit="return confirm('Delete account permanently? This cannot be undone.');">
                    {% csrf_token %}
                    <button
                        class="btn bg-red-600 hover:bg-red-700 text-red-100 dark:bg-red-800 dark:hover:bg-red-900 dark:text-red-200"
                        type="submit">Delete account</button>
                </form>
            </div>
        </div>
    </form>
</div>
{% endblock %}